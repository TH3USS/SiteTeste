@model Endereco
@{
    int pessoaId = (int)ViewBag.PessoaId;
}

<h2>Cadastrar Endereço</h2>

<form asp-action="Create" method="post">
    <input type="hidden" name="PessoaId" value="@pessoaId" />
    <div class="form-group">
        <label for="Logradouro">Logradouro</label>
        <input type="text" id="Logradouro" name="Logradouro" class="form-control" required />
    </div>
    <div class="form-group">
        <label for="CEP">CEP</label>
        <input type="text" id="CEP" name="CEP" class="form-control" required />
    </div>
    <div class="form-group">
        <label for="Cidade">Cidade</label>
        <input type="text" id="Cidade" name="Cidade" class="form-control" required />
    </div>
    <div class="form-group">
        <label for="Estado">Estado</label>
        <input type="text" id="Estado" name="Estado" class="form-control" required />
    </div>
    <button type="submit" class="btn btn-primary">Salvar</button>
    <a href="@Url.Action("Index", "Endereco", new { pessoaId = pessoaId })" class="btn btn-secondary">Cancelar</a>

</form>

<script>
    document.getElementById("CEP").addEventListener("blur", async function () {
        const cep = this.value.replace(/\D/g, ''); // Remove caracteres não numéricos
        if (cep.length !== 8) {
            alert("Por favor, insira um CEP válido com 8 dígitos.");
            return;
        }

        try {
            const response = await fetch(`https://viacep.com.br/ws/${cep}/json/`);
            if (!response.ok) {
                throw new Error("Não foi possível buscar o CEP.");
            }
            const data = await response.json();

            if (data.erro) {
                alert("CEP não encontrado.");
                return;
            }

            // Preenche os campos com os dados retornados
            document.getElementById("Logradouro").value = data.logradouro || "";
            document.getElementById("Cidade").value = data.localidade || "";
            document.getElementById("Estado").value = data.uf || "";
        } catch (error) {
            console.error("Erro ao buscar o CEP:", error);
            alert("Erro ao buscar o CEP. Verifique sua conexão ou tente novamente.");
        }
    });
</script>
